<?php
#load config
require ('config.php');
require FUNCTIONS;
require CLASSES.'ImageObject.php';

$params = array_merge($_POST, $_GET, $_FILES);

#bootstrapper
if (empty($params)){
    require (VIEW.DEFAULTPAGE);
    exit();
}

debug(__FILE__,__LINE__,$params);

switch($params['action']) {
case ACTION_LIST:
	require VIEW.LISTVIEW;
	break;
case ACTION_UPLOAD:
	require VIEW.UPLOAD;
	break;
case ACTION_UPLOAD_PART2:
	if($params['upload']['error'] == UPLOAD_ERR_NO_FILE){
		require VIEW.UPLOAD;
		break;
	}
	if($params['upload']['error'] != UPLOAD_ERR_OK){
		require VIEW.ERROR;
		break;
	}
	$filename = time();
	if(move_uploaded_file($params['upload']['tmp_name'], $DATA.$filename)){
		// ...
		#ImageObjekt erzeugen
		$image = new ImageObject(DATA.$filename, $params['upload']['name']);
		
		$image->size = $params['upload']['size'];
		$image->mimetype = $params['upload']['mimetype'];
		
		$image->keywords = strip_tags($params['upload']['keywords']);
		$image->description = strip_tags($params['upload']['description']);
		$image->owner = strip_tags($params['upload']['owner']);
		$image->ip = $_SERVER['REMOTE_ADDR'];
		$image->date = date('d\.m\.Y H\:i');
		
		$image->create();
		break;
	} else {
		require VIEW.ERRORPAGE;
		break;
	}
	break;
case ACTION_DELETE:
	require VIEW.DELETE;
	break;
default:
	require VIEW.DEFAULTPAGE;
}
?>
